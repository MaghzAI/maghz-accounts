# نظام المصادقة والأمان

## نظرة عامة

نظام المصادقة في مغاز للمحاسبة هو نظام أمان شامل يضمن حماية البيانات والتحكم في الوصول للنظام. يستخدم أحدث التقنيات الأمنية لضمان سلامة المعلومات المالية.

## المزايا الأمنية

- **مصادقة آمنة**: استخدام NextAuth.js v5 للمصادقة الموثوقة
- **تشفير كلمات المرور**: استخدام bcrypt لتشفير كلمات المرور
- **إدارة الجلسات**: إدارة جلسات المستخدمين بشكل آمن
- **حماية المسارات**: حماية الصفحات والمسارات حسب الأدوار
- **تتبع العمليات**: سجل كامل لجميع العمليات (Audit Trail)

## أنواع المستخدمين وأدوارهم

### 1. المدير (Admin)
- صلاحيات كاملة على النظام
- إدارة المستخدمين والأدوار
- الوصول لجميع التقارير والإعدادات
- إدارة النظام والتكوينات

### 2. المحاسب (Accountant)
- إدارة الحسابات والمعاملات
- الوصول للتقارير المالية
- إدارة العملاء والموردين
- تسوية الحسابات البنكية

### 3. المستخدم العادي (User)
- الوصول للعمليات الأساسية
- عرض التقارير والمعاملات
- إدخال البيانات الأساسية

## عملية تسجيل الدخول

### خطوات تسجيل الدخول
1. **الانتقال لصفحة الدخول**: `http://localhost:3000/login`
2. **إدخال بيانات الدخول**:
   - البريد الإلكتروني
   - كلمة المرور
3. **الضغط على "تسجيل الدخول"**
4. **توجيه المستخدم للوحة التحكم**

### حسابات الاختبار المتاحة

#### حساب المدير
- **البريد الإلكتروني**: admin@maghzaccounts.com
- **كلمة المرور**: admin123
- **الصلاحيات**: جميع الصلاحيات

#### حساب التجريبي
- **البريد الإلكتروني**: demo@maghzaccounts.com
- **كلمة المرور**: demo123
- **الصلاحيات**: صلاحيات محدودة للعرض والتجربة

## إنشاء حساب جديد

### خطوات إنشاء الحساب
1. **الانتقال لصفحة التسجيل**: `http://localhost:3000/register`
2. **ملء النموذج**:
   - الاسم الكامل
   - البريد الإلكتروني
   - كلمة المرور
   - تأكيد كلمة المرور
3. **الموافقة على الشروط والأحكام**
4. **الضغط على "إنشاء الحساب"**

### قواعد كلمة المرور
- الحد الأدنى 8 أحرف
- يجب أن تحتوي على أحرف كبيرة وصغيرة
- يجب أن تحتوي على أرقام
- يجب أن تحتوي على رموز خاصة

## إدارة الجلسات

### مدة الجلسة
- **الجلسة النشطة**: 24 ساعة
- **الجلسة المذكورة**: 30 يوماً
- **الجلسة الخاملة**: 7 أيام

### تسجيل الخروج
- **الخروج اليدوي**: من خلال قائمة المستخدم
- **الخروج التلقائي**: عند انتهاء الجلسة
- **إنهاء جميع الجلسات**: من إعدادات الحساب

## حماية المسارات والصفحات

### المسارات المحمية
- جميع صفحات لوحة التحكم
- صفحات إدارة الحسابات
- صفحات المعاملات والتقارير
- صفحات الإعدادات

### المسارات العامة
- الصفحة الرئيسية
- صفحة تسجيل الدخول
- صفحة إنشاء الحساب
- صفحات المساعدة والدعم

## تتبع العمليات (Audit Trail)

### ما يتم تتبعه
- **تسجيل الدخول والخروج**: جميع عمليات المصادقة
- **إنشاء المستخدمين**: إضافة مستخدمين جدد
- **تعديل الأدوار**: تغيير صلاحيات المستخدمين
- **العمليات المالية**: جميع المعاملات المحاسبية
- **التغييرات في البيانات**: إنشاء، تعديل، حذف البيانات

### معلومات السجل
- **المستخدم**: من قام بالعملية
- **الوقت**: تاريخ ووقت العملية
- **النوع**: نوع العملية (إنشاء، تعديل، حذف، عرض)
- **البيانات**: التغييرات التي تمت
- **العنوان**: عنوان IP للمستخدم

## إعدادات الأمان

### تغيير كلمة المرور
1. **الانتقال للإعدادات**: من قائمة المستخدم
2. **اختيار "تغيير كلمة المرور"**
3. **إدخال كلمة المرور الحالية**
4. **إدخال كلمة المرور الجديدة**
5. **تأكيد كلمة المرور الجديدة**
6. **حفظ التغييرات**

### إدارة الجلسات النشطة
- **عرض الجلسات**: جميع الأجهزة المسجلة
- **إنهاء جلسة**: إنهاء جلسة معينة
- **إنهاء جميع الجلسات**: تسجيل الخروج من جميع الأجهزة

## الحماية من المخاطر الأمنية

### حماية من الهجمات
- **SQL Injection**: حماية من خلال Drizzle ORM
- **XSS**: تنظيف وتعقيم البيانات المدخلة
- **CSRF**: حماية من هجمات التزييف
- **Session Hijacking**: تشفير الجلسات

### التحقق من البيانات
- **التحقق من البريد الإلكتروني**: صحة تنسيق البريد
- **التحقق من كلمة المرور**: قوة كلمة المرور
- **التحقق من البيانات**: صحة البيانات المدخلة

## التعامل مع المشاكل

### نسيت كلمة المرور
1. **الانتقال لصفحة الدخول**
2. **الضغط على "نسيت كلمة المرور؟"**
3. **إدخال البريد الإلكتروني**
4. **اتباع التعليمات في البريد الإلكتروني**

### حساب مقفل
- **عدد المحاولات**: 5 محاولات فاشلة
- **مدة القفل**: 30 دقيقة
- **التواصل مع المدير**: لإعادة التفعيل

## نصائح الأمان

### للمستخدمين
- استخدام كلمات مرور قوية
- عدم مشاركة بيانات الدخول
- تسجيل الخروج عند الانتهاء
- تحديث كلمة المرور بانتظام

### للمدراء
- مراجعة سجلات العمليات بانتظام
- تحديث الأدوار حسب الحاجة
- مراقبة النشاط المشبوه
- نسخ احتياطي من البيانات

## الدعم التقني

### المشاكل الشائعة
- **مشكلة في تسجيل الدخول**: التحقق من البيانات المدخلة
- **بطء في الأداء**: مسح ذاكرة المتصفح
- **خطأ في الصفحة**: تحديث الصفحة أو تسجيل الخروج والدخول

### التواصل مع الدعم
- **البريد الإلكتروني**: support@maghzaccounts.com
- **رقم الهاتف**: سيتم توفيره لاحقاً
- **الدردشة المباشرة**: متاحة في النظام

---

**ملاحظة**: الأمان هو أولوية قصوى في النظام. يتم تطبيق أحدث المعايير والممارسات الأمنية لحماية بياناتك.
